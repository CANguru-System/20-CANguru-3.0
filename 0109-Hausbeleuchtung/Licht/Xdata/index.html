<!DOCTYPE HTML>
<html>

<!-- The `<head>` section in HTML is used to provide meta-information about the document and to link
external resources. -->

<head>
    <title>Hausbeleuchtung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta charset="UTF-8">
</head>

<!-- The `<body>` section in the HTML code you provided is defining the structure of the webpage content
that will be displayed to the user. Here's a breakdown of what each element inside the `<body>` is
doing: -->

<body>
    <h2>Hausbeleuchtung 1.00</h2>
    <div class="ipnbr" id="IPNbr">XXX</div>
    <div class="box" id="box">
        <!-- Raum relativ -->
        <div class="dropdown0 dropdownleft">
            <label class="selectstyle" for="Raum">Raum</label>
            <select id="Raum"></select>
        </div>
        <!-- onTime 1 - 25 -->
        <div class="dropdown0 dropdownmiddle">
            <label class="selectstyle" for="onTime">onTime</label>
            <select id="onTime"></select>
        </div>
        <!-- offTime 1 - 25 -->
        <div class="dropdown0 dropdownright">
            <label class="selectstyle" for="offTime">offTime</label>
            <select id="offTime"></select>
        </div>
        <!-- Brightness 1 - 255 -->
        <div class="dropdown1 dropdownleftt">
            <label class="selectstyle" for="brightness">Brightness</label>
            <select id="brightness"></select>
        </div>
        <div class="line-with-text lwt225">für alle Räume</div>
        <!-- Zeitfaktor 500 - 50000 -->
        <div class="dropdown2 dropdownleft">
            <label class="selectstyle" for="zeitfaktor">Zeitfaktor</label>
            <select id="zeitfaktor"></select>
        </div>
        <!-- Nutzung 1 - 24 -->
        <div class="dropdown2 dropdownmiddle">
            <label class="selectstyle" for="nutzung">genutzte LED</label>
            <select id="nutzung"></select>
        </div>
        <div class="line-with-text lwt325">Effektauswahl</div>
    </div>
</body>

<script>

    const radioGroupName = 'myRadioEffectGroup'; // Name der Radio-Button-Gruppe

    /* The `setChecked` function is used to set a specific radio button as checked based on the provided
    `id`. Here's a breakdown of what the function does: */
    // Einen bestimmten Radio-Button setzen
    function setChecked(value) {
        const radios = document.getElementsByName(radioGroupName);
        radios.forEach(radio => {
            if (radio.value === value) {
                radio.checked = true;
            }
        });
    }

    // Den ausgewählten Radio-Button-Wert abfragen
    function getSelectedValue() {
        const radios = document.getElementsByName(radioGroupName);
        for (const radio of radios) {
            if (radio.checked) {
                return radio.id;
            }
        }
        return null; // Falls keiner ausgewählt ist
    }

    // Funktion, um einen Button dynamisch zu erstellen
    /* The `createButton` function in the provided HTML code is responsible for dynamically creating a
    button element and adding it to the HTML document. Here's a breakdown of what the function does: */
    function createButton(left) {
        // Button-Element erstellen
        const button = document.createElement('button');

        // Textinhalt des Buttons setzen
        button.textContent = 'S P E I C H E R N';

        // CSS-Klasse hinzufügen
        button.classList.add('custom-button');

        // Position des Buttons festlegen (Abstand vom oberen und linken Rand)
        button.style.left = left + 'px'; // Xpx vom linken Rand

        // Event-Listener für Klick hinzufügen
        button.addEventListener('click', () => {
            var xhttpsetparams = new XMLHttpRequest();
            var raum = parseInt(Raum.value);
            var onT = parseInt(onTime.value);
            var offT = parseInt(offTime.value);
            var bright = parseInt(brightness.value);
            var zeitf = parseInt(zeitfaktor.value);
            var nutz = parseInt(nutzung.value);
            if (nutz == 96)
                nutz = 95; // damit 96 auch in der Liste erscheint
            // Function to get the selected radio button value
            //            const selectedRadio = document.querySelector('input[name="group1"]:checked');
            var effect = getSelectedValue();
            // transportiert die aktuellen Werte zum ESP32C3
            var callSrv = "/SETPARAMS/" + String(raum) + "/" + String(onT) + "/" + String(offT) + "/" + String(bright) + "/" + String(zeitf) + "/" + String(nutz) + "/" + String(effect) + "/";
            xhttpsetparams.open("GET", callSrv, true);
            xhttpsetparams.send();
        });

        // Select the container (box)
        const container = document.getElementById('box');

        // Button zum Body hinzufügen
        container.appendChild(button);
    }

    // Funktion zum Erstellen eines Radio-Buttons
    /*The`createRadioButton` function in the provided HTML code is responsible for dynamically creating a
    radio button element along with its associated label and returning the combined element.Here's a
    breakdown of what the function does:*/
    function createRadioButton(id, value, labelText, left) {
        // Radio-Button erstellen
        const radioButton = document.createElement('input');
        radioButton.type = 'radio';
        radioButton.name = radioGroupName; // Alle Radio-Buttons gehören zur gleichen Gruppe
        radioButton.id = id; //`radio-${id}`;
        radioButton.value = value; // Wert des Buttons
        radioButton.className = 'custom-radio'; // CSS-Klasse hinzufügen

        // Label für den Radio-Button erstellen
        const label = document.createElement('label');
        label.htmlFor = radioButton.id;
        label.textContent = labelText; // Text für das Label
        label.className = 'custom-radio-label'; // CSS-Klasse hinzufügen
        label.style.left = left + "px";
        label.appendChild(radioButton); // Radio-Button ins Label einfügen

        return label; // Label zurückgeben (enthält den Radio-Button)
    }

    /////////////////////////////////////////////////////////////////////////////////////

    // fragt den ESP32C3 nach der IP-Adresse und zeigt sie auf der HTML-Seite an
    /* The code snippet you provided is setting up a timer `myIPTimer` and a function `call4IP` that makes
    an XMLHttpRequest to retrieve the IP address from a server endpoint `/ IPNBR / `. */
    var myIPTimer;
    var call4IP = function () {
        var xhttpIP = new XMLHttpRequest();
        xhttpIP.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("IPNbr").innerText = "IP: " + xhttpIP.responseText;
                clearInterval(myIPTimer);
            }
        };
        xhttpIP.open("GET", "/IPNBR/", true);
        xhttpIP.send();
    };

    // fragt den ESP32C3 nach den aktuellen Parametern und zeigt sie auf der HTML-Seite an
    /* The above code is a JavaScript function that makes an XMLHttpRequest to retrieve parameters from a
    server. It splits the response text into an array and assigns the values to specific HTML elements
    with IDs 'onTime', 'offTime', 'brightness', 'zeitfaktor', and 'nutzung'. Finally, it clears a timer
    named myGETParamsTimer. */
    var myGETParamsTimer;
    var call4Params = function () {
        var xhttpParams = new XMLHttpRequest();
        xhttpParams.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                clearInterval(myGETParamsTimer);
                var array_reponseParams = xhttpParams.responseText.split("/"); //
                const param0 = document.getElementById('onTime');
                param0.value = parseInt(array_reponseParams[0]);
                const param1 = document.getElementById('offTime');
                param1.value = parseInt(array_reponseParams[1]);
                const param2 = document.getElementById('brightness');
                param2.value = parseInt(array_reponseParams[2]);
                const param3 = document.getElementById('zeitfaktor');
                param3.value = parseInt(array_reponseParams[3]);
                const param4 = document.getElementById('nutzung');
                param4.value = parseInt(array_reponseParams[4]);
                var opt = 'option' + (parseInt(array_reponseParams[5]) + 1).toString();
                setChecked(opt);
            }
        };
        xhttpParams.open("GET", "/GETPARAMS/", true);
        xhttpParams.send();
    };

    // erzeugt gemäß den übergebenen Paramtern eine dropdown-liste, die bei Draufklicken angezeigt wird
    /* The above code is a JavaScript function named `setNumberValue` that is responsible for populating a
    dropdown element with numbers within a specified range. Here is a breakdown of what the code does: */
    function setNumberValue(element) {
        // Set the range limits
        var min;
        var max;
        var step;
        var val;
        var xhttpParams = new XMLHttpRequest();
        xhttpParams.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var array_reponseParams = xhttpParams.responseText.split("/"); // min, max, step, val
                min = parseInt(array_reponseParams[0]);
                max = parseInt(array_reponseParams[1]);
                if (max == 95)
                    max = 96;  // damit 96 auch in der Liste erscheint
                // im ESP32C3 wird ab 0 gerechnet
                step = parseInt(array_reponseParams[2]);
                val = parseInt(array_reponseParams[3]);
                // Get the dropdown element
                const dropdown = document.getElementById(element);

                // Populate the dropdown with numbers within the range
                for (let i = min; i <= max; i += step) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    dropdown.appendChild(option);
                }
                // Set its value
                dropdown.value = val;
            }
        };
        xhttpParams.open("GET", "/" + element, true);
        xhttpParams.send();
    }


    // nach Ändern der Raumnummer wird diese an den ESP32C3 gesendet und dieser sendet die
    // zu dieser Raumnummer gehörenden Werte, und diese werden auf der HTML-Seite angezeigt
    /* The code snippet you provided is setting up an event listener for the 'change' event on the element
    with the ID 'Raum'. When the value of this element changes, the event listener triggers a function
    that performs the following actions: */
    const chgRaum = document.getElementById('Raum');
    chgRaum.addEventListener('change', function (event) {
        var chgRaum = new XMLHttpRequest();
        const v = document.getElementById('Raum');
        var value = parseInt(v.value)
        chgRaum.open("GET", "/CHGRAUM/" + String(value) + "/", true);
        chgRaum.send();
        setNumberValue('onTime');
        setNumberValue('offTime');
        setNumberValue('brightness');
        setNumberValue('zeitfaktor');
        setNumberValue('nutzung');
    });

    // Container für die Radio-Buttons auswählen
    /* The code snippet provided is a mix of HTML and JavaScript. Here is a breakdown of what the code is
    doing: */
    const container = document.getElementById('box');
    // Radio-Buttons erstellen und zum Container hinzufügen
    container.appendChild(createRadioButton(0, 'option1', 'Hausbeleuchtung', 20));
    container.appendChild(createRadioButton(1, 'option2', 'Effekte', 220));
    container.appendChild(createRadioButton(2, 'option3', 'Test', 420));
    setChecked('option1');
    // Call the function to create the button
    createButton(600);
    // Laden der IP-Adresse
    myIPTimer = setInterval(call4IP, 200);

    // Füllen der drpdown-Liste
    setNumberValue('Raum');
    setNumberValue('onTime');
    setNumberValue('offTime');
    setNumberValue('brightness');
    setNumberValue('zeitfaktor');
    setNumberValue('nutzung');

    // Laden der Paramter Raum, onTime. offtime, brightness, zeitfaktor
    myGETParamsTimer = setInterval(call4Params, 200);

</script>

</html>